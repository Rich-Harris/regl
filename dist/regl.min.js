(function(Na){"object"===typeof exports&&"undefined"!==typeof module?module.exports=Na():"function"===typeof define&&define.amd?define([],Na):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).createREGL=Na()})(function(){return function e(t,w,p){function g(c,a){if(!w[c]){if(!t[c]){var b="function"==typeof require&&require;if(!a&&b)return b(c,!0);if(y)return y(c,!0);b=Error("Cannot find module '"+c+"'");throw b.code="MODULE_NOT_FOUND",b;}b=
w[c]={exports:{}};t[c][0].call(b.exports,function(a){var b=t[c][1][a];return g(b?b:a)},b,b.exports,e,t,w,p)}return w[c].exports}for(var y="function"==typeof require&&require,v=0;v<p.length;v++)g(p[v]);return g}({1:[function(e,t,w){function p(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=function(g,y,v,c,a){g=v.maxAttributes;y=Array(g);for(v=0;v<g;++v)y[v]=new p;return{Record:p,scope:{},state:y}}},
{}],2:[function(e,t,w){function p(c){return n[Object.prototype.toString.call(c)]|0}function g(c,a){for(var b=0;b<a.length;++b)c[b]=a[b]}function y(c,a,b,g,p,v,y){for(var r=0,h=0;h<b;++h)for(var e=0;e<g;++e)c[r++]=a[p*h+v*e+y]}var v=e("./util/is-typed-array"),c=e("./util/is-ndarray"),a=e("./util/values"),b=e("./util/pool");w=e("./util/flatten");var F=w.flatten,K=w.shape,n=e("./constants/arraytypes.json"),z=e("./constants/dtypes.json"),r=e("./constants/usage.json"),D=[];D[5120]=1;D[5122]=2;D[5124]=
4;D[5121]=1;D[5123]=2;D[5125]=4;D[5126]=4;t.exports=function(e,n,k){function m(c){this.id=E++;this.buffer=e.createBuffer();this.type=c;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;k.profile&&(this.stats={size:0})}function B(c,a,b){c.byteLength=a.byteLength;e.bufferData(c.type,a,b)}function t(a,h,m,e,k,r){a.usage=m;if(Array.isArray(h)){if(a.dtype=e||5126,0<h.length)if(Array.isArray(h[0])){k=K(h);for(var I=e=1;I<k.length;++I)e*=k[I];a.dimension=e;h=F(h,
k,a.dtype);B(a,h,m);r?a.persistentData=h:b.freeType(h)}else"number"===typeof h[0]?(a.dimension=k,k=b.allocType(a.dtype,h.length),g(k,h),B(a,k,m),r?a.persistentData=k:b.freeType(k)):v(h[0])&&(a.dimension=h[0].length,a.dtype=e||p(h[0])||5126,h=F(h,[h.length,h[0].length],a.dtype),B(a,h,m),r?a.persistentData=h:b.freeType(h))}else if(v(h))a.dtype=e||p(h),a.dimension=k,B(a,h,m),r&&(a.persistentData=new Uint8Array(new Uint8Array(h.buffer)));else if(c(h)){k=h.shape;var n=h.stride,I=h.offset,z=0,ea=0,u=0,
C=0;1===k.length?(z=k[0],ea=1,u=n[0],C=0):2===k.length&&(z=k[0],ea=k[1],u=n[0],C=n[1]);a.dtype=e||p(h.data)||5126;a.dimension=ea;k=b.allocType(a.dtype,z*ea);y(k,h.data,z,ea,u,C,I);B(a,k,m);r?a.persistentData=k:b.freeType(k)}}function L(c){n.bufferCount--;e.deleteBuffer(c.buffer);c.buffer=null;delete h[c.id]}var E=0,h={};m.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)};m.prototype.destroy=function(){L(this)};var ba=[];k.profile&&(n.getTotalBufferSize=function(){var c=0;Object.keys(h).forEach(function(a){c+=
h[a].stats.size});return c});return{create:function(a,B,E,ba){function w(a){var h=35044,b=null,g=0,u=0,m=1;Array.isArray(a)||v(a)||c(a)?b=a:"number"===typeof a?g=a|0:a&&("data"in a&&(b=a.data),"usage"in a&&(h=r[a.usage]),"type"in a&&(u=z[a.type]),"dimension"in a&&(m=a.dimension|0),"length"in a&&(g=a.length|0));A.bind();b?t(A,b,h,u,m,ba):(e.bufferData(A.type,g,h),A.dtype=u||5121,A.usage=h,A.dimension=m,A.byteLength=g);k.profile&&(A.stats.size=A.byteLength*D[A.dtype]);return w}n.bufferCount++;var A=
new m(B);h[A.id]=A;E||w(a);w._reglType="buffer";w._buffer=A;w.subdata=function(a,h){var m=(h||0)|0,k;A.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var u=b.allocType(A.dtype,a.length);g(u,a);e.bufferSubData(A.type,m,u);b.freeType(u)}else if(Array.isArray(a[0])||v(a[0]))k=K(a),u=F(a,k,A.dtype),e.bufferSubData(A.type,m,u),b.freeType(u)}else if(v(a))e.bufferSubData(A.type,m,a);else if(c(a)){k=a.shape;var r=a.stride,n=u=0,B=0,z=0;1===k.length?(u=k[0],n=1,B=r[0],z=0):2===k.length&&
(u=k[0],n=k[1],B=r[0],z=r[1]);k=Array.isArray(a.data)?A.dtype:p(a.data);k=b.allocType(k,u*n);y(k,a.data,u,n,B,z,a.offset);e.bufferSubData(A.type,m,k);b.freeType(k)}return w};k.profile&&(w.stats=A.stats);w.destroy=function(){L(A)};return w},createStream:function(a,c){var h=ba.pop();h||(h=new m(a));h.bind();t(h,c,35040,0,1,!1);return h},destroyStream:function(a){ba.push(a)},clear:function(){a(h).forEach(L);ba.forEach(L)},getBuffer:function(a){return a&&a._buffer instanceof m?a._buffer:null},restore:function(){a(h).forEach(function(a){a.buffer=
e.createBuffer();e.bindBuffer(a.type,a.buffer);e.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:t}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./constants/usage.json":6,"./util/flatten":23,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],3:[function(e,t,w){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,
"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(e,t,w){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],5:[function(e,t,w){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(e,t,w){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],7:[function(e,t,w){function p(a){return Array.isArray(a)||
K(a)||n(a)}function g(a){return a.sort(function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1})}function y(a,c,b,k){this.thisDep=a;this.contextDep=c;this.propDep=b;this.append=k}function v(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new y(!1,!1,!1,a)}function a(a,c){var b=a.type;return 0===b?(b=a.data.length,new y(!0,1<=b,2<=b,c)):4===b?(b=a.data,new y(b.thisDep,b.contextDep,b.propDep,c)):new y(3===b,2===b,1===b,c)}var b=e("./util/codegen"),F=e("./util/loop"),
K=e("./util/is-typed-array"),n=e("./util/is-ndarray"),z=e("./util/is-array-like"),r=e("./dynamic"),D=e("./constants/primitives.json"),C=e("./constants/dtypes.json"),N=["x","y","z","w"],k="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),m={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,
"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},B={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},U={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},L={cw:2304,ccw:2305},E=new y(!1,!1,!1,function(){});t.exports=function(h,
e,n,t,K,w,V,A,I,za,ua,ea,u,fa,ga){function X(d){return d.replace(".","_")}function Q(d,a,c){var b=X(d);l.push(d);q[b]=f[b]=!!c;va[b]=a}function H(d,a,c){var b=X(d);l.push(d);Array.isArray(c)?(f[b]=c.slice(),q[b]=c.slice()):f[b]=q[b]=c;wa[b]=a}function M(){var d=b(),a=d.link,c=d.global;d.id=Ra++;d.batchId="0";var h=a(Qa),q=d.shared={props:"a0"};Object.keys(Qa).forEach(function(d){q[d]=c.def(h,".",d)});var Ka=d.next={},O=d.current={};Object.keys(wa).forEach(function(d){Array.isArray(f[d])&&(Ka[d]=c.def(q.next,
".",d),O[d]=c.def(q.current,".",d))});var Sa=d.constants={};Object.keys(La).forEach(function(d){Sa[d]=c.def(JSON.stringify(La[d]))});d.invoke=function(f,G){switch(G.type){case 0:var c=["this",q.context,q.props,d.batchId];return f.def(a(G.data),".call(",c.slice(0,Math.max(G.data.length+1,4)),")");case 1:return f.def(q.props,G.data);case 2:return f.def(q.context,G.data);case 3:return f.def("this",G.data);case 4:return G.data.append(d,f),G.data.ref}};d.attribCache={};var G={};d.scopeAttrib=function(d){d=
e.id(d);if(d in G)return G[d];var f=za.scope[d];f||(f=za.scope[d]=new Aa);return G[d]=a(f)};return d}function Ea(d){var f=d["static"];d=d.dynamic;var b;if("profile"in f){var h=!!f.profile;b=c(function(d,f){return h});b.enable=h}else if("profile"in d){var q=d.profile;b=a(q,function(d,f){return d.invoke(f,q)})}return b}function la(d,f){var b=d["static"],h=d.dynamic;if("framebuffer"in b){var q=b.framebuffer;return q?(q=A.getFramebuffer(q),c(function(d,f){var a=d.link(q),x=d.shared;f.set(x.framebuffer,
".next",a);x=x.context;f.set(x,".framebufferWidth",a+".width");f.set(x,".framebufferHeight",a+".height");return a})):c(function(d,f){var a=d.shared;f.set(a.framebuffer,".next","null");a=a.context;f.set(a,".framebufferWidth",a+".drawingBufferWidth");f.set(a,".framebufferHeight",a+".drawingBufferHeight");return"null"})}if("framebuffer"in h){var Ka=h.framebuffer;return a(Ka,function(d,f){var a=d.invoke(f,Ka),x=d.shared,c=x.framebuffer,a=f.def(c,".getFramebuffer(",a,")");f.set(c,".next",a);x=x.context;
f.set(x,".framebufferWidth",a+"?"+a+".width:"+x+".drawingBufferWidth");f.set(x,".framebufferHeight",a+"?"+a+".height:"+x+".drawingBufferHeight");return a})}return null}function xa(d,f,c){function b(d){if(d in h){var G=h[d];d=!0;var c=G.x|0,pa=G.y|0,O,W;"width"in G?O=G.width|0:d=!1;"height"in G?W=G.height|0:d=!1;return new y(!d&&f&&f.thisDep,!d&&f&&f.contextDep,!d&&f&&f.propDep,function(d,f){var a=d.shared.context,x=O;"width"in G||(x=f.def(a,".","framebufferWidth","-",c));var b=W;"height"in G||(b=
f.def(a,".","framebufferHeight","-",pa));return[c,pa,x,b]})}if(d in q){var l=q[d];d=a(l,function(d,f){var a=d.invoke(f,l),G=d.shared.context,c=f.def(a,".x|0"),x=f.def(a,".y|0"),pa=f.def('"width" in ',a,"?",a,".width|0:","(",G,".","framebufferWidth","-",c,")"),a=f.def('"height" in ',a,"?",a,".height|0:","(",G,".","framebufferHeight","-",x,")");return[c,x,pa,a]});f&&(d.thisDep=d.thisDep||f.thisDep,d.contextDep=d.contextDep||f.contextDep,d.propDep=d.propDep||f.propDep);return d}return f?new y(f.thisDep,
f.contextDep,f.propDep,function(d,f){var a=d.shared.context;return[0,0,f.def(a,".","framebufferWidth"),f.def(a,".","framebufferHeight")]}):null}var h=d["static"],q=d.dynamic;if(d=b("viewport")){var O=d;d=new y(d.thisDep,d.contextDep,d.propDep,function(d,f){var a=O.append(d,f),c=d.shared.context;f.set(c,".viewportWidth",a[2]);f.set(c,".viewportHeight",a[3]);return a})}return{viewport:d,scissor_box:b("scissor.box")}}function R(d){function f(d){if(d in b){var G=e.id(b[d]);d=c(function(){return G});d.id=
G;return d}if(d in h){var x=h[d];return a(x,function(d,f){var a=d.invoke(f,x);return f.def(d.shared.strings,".id(",a,")")})}return null}var b=d["static"],h=d.dynamic,q=f("frag"),l=f("vert"),O=null;v(q)&&v(l)?(O=ua.program(l.id,q.id),d=c(function(d,f){return d.link(O)})):d=new y(q&&q.thisDep||l&&l.thisDep,q&&q.contextDep||l&&l.contextDep,q&&q.propDep||l&&l.propDep,function(d,f){var a=d.shared.shader,c;c=q?q.append(d,f):f.def(a,".","frag");var x;x=l?l.append(d,f):f.def(a,".","vert");return f.def(a+
".program("+x+","+c+")")});return{frag:q,vert:l,progVar:d,program:O}}function ha(d,f){function b(d,f){if(d in q){var x=q[d]|0;return c(function(d,a){f&&(d.OFFSET=x);return x})}if(d in h){var pa=h[d];return a(pa,function(d,a){var c=d.invoke(a,pa);f&&(d.OFFSET=c);return c})}return f&&l?c(function(d,f){d.OFFSET="0";return 0}):null}var q=d["static"],h=d.dynamic,l=function(){if("elements"in q){var d=q.elements;p(d)?d=w.getElements(w.create(d,!0)):d&&(d=w.getElements(d));var f=c(function(f,a){if(d){var c=
f.link(d);return f.ELEMENTS=c}return f.ELEMENTS=null});f.value=d;return f}if("elements"in h){var x=h.elements;return a(x,function(d,f){var a=d.shared,c=a.isBufferArgs,a=a.elements,G=d.invoke(f,x),b=f.def("null"),c=f.def(c,"(",G,")"),G=d.cond(c).then(b,"=",a,".createStream(",G,");")["else"](b,"=",a,".getElements(",G,");");f.entry(G);f.exit(d.cond(c).then(a,".destroyStream(",b,");"));return d.ELEMENTS=b})}return null}(),O=b("offset",!0);return{elements:l,primitive:function(){if("primitive"in q){var d=
q.primitive;return c(function(f,a){return D[d]})}if("primitive"in h){var f=h.primitive;return a(f,function(d,a){var c=d.constants.primTypes,x=d.invoke(a,f);return a.def(c,"[",x,"]")})}return l?v(l)?l.value?c(function(d,f){return f.def(d.ELEMENTS,".primType")}):c(function(){return 4}):new y(l.thisDep,l.contextDep,l.propDep,function(d,f){var a=d.ELEMENTS;return f.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in q){var d=q.count|0;return c(function(){return d})}if("count"in h){var f=
h.count;return a(f,function(d,a){return d.invoke(a,f)})}return l?v(l)?l?O?new y(O.thisDep,O.contextDep,O.propDep,function(d,f){return f.def(d.ELEMENTS,".vertCount-",d.OFFSET)}):c(function(d,f){return f.def(d.ELEMENTS,".vertCount")}):c(function(){return-1}):new y(l.thisDep||O.thisDep,l.contextDep||O.contextDep,l.propDep||O.propDep,function(d,f){var a=d.ELEMENTS;return d.OFFSET?f.def(a,"?",a,".vertCount-",d.OFFSET,":-1"):f.def(a,"?",a,".vertCount:-1")}):null}(),instances:b("instances",!1),offset:O}}
function ia(d,f){var b=d["static"],q=d.dynamic,h={};l.forEach(function(d){function f(G,l){if(d in b){var pa=G(b[d]);h[x]=c(function(){return pa})}else if(d in q){var O=q[d];h[x]=a(O,function(d,f){return l(d,f,d.invoke(f,O))})}}var x=X(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return f(function(d){return d},function(d,f,a){return a});
case "depth.func":return f(function(d){return B[d]},function(d,f,a){return f.def(d.constants.compareFuncs,"[",a,"]")});case "depth.range":return f(function(d){return d},function(d,f,a){d=f.def("+",a,"[0]");f=f.def("+",a,"[1]");return[d,f]});case "blend.func":return f(function(d){return[m["srcRGB"in d?d.srcRGB:d.src],m["dstRGB"in d?d.dstRGB:d.dst],m["srcAlpha"in d?d.srcAlpha:d.src],m["dstAlpha"in d?d.dstAlpha:d.dst]]},function(d,f,a){function c(d,x){return f.def('"',d,x,'" in ',a,"?",a,".",d,x,":",
a,".",d)}d=d.constants.blendFuncs;var x=c("src","RGB"),b=c("dst","RGB"),x=f.def(d,"[",x,"]"),q=f.def(d,"[",c("src","Alpha"),"]"),b=f.def(d,"[",b,"]");d=f.def(d,"[",c("dst","Alpha"),"]");return[x,b,q,d]});case "blend.equation":return f(function(d){if("string"===typeof d)return[Y[d],Y[d]];if("object"===typeof d)return[Y[d.rgb],Y[d.alpha]]},function(d,f,a){var c=d.constants.blendEquations,x=f.def(),b=f.def();d=d.cond("typeof ",a,'==="string"');d.then(x,"=",b,"=",c,"[",a,"];");d["else"](x,"=",c,"[",a,
".rgb];",b,"=",c,"[",a,".alpha];");f(d);return[x,b]});case "blend.color":return f(function(d){return F(4,function(f){return+d[f]})},function(d,f,a){return F(4,function(d){return f.def("+",a,"[",d,"]")})});case "stencil.mask":return f(function(d){return d|0},function(d,f,a){return f.def(a,"|0")});case "stencil.func":return f(function(d){return[B[d.cmp||"keep"],d.ref||0,"mask"in d?d.mask:-1]},function(d,f,a){d=f.def('"cmp" in ',a,"?",d.constants.compareFuncs,"[",a,".cmp]",":",7680);var c=f.def(a,".ref|0");
f=f.def('"mask" in ',a,"?",a,".mask|0:-1");return[d,c,f]});case "stencil.opFront":case "stencil.opBack":return f(function(f){return["stencil.opBack"===d?1029:1028,U[f.fail||"keep"],U[f.zfail||"keep"],U[f.zpass||"keep"]]},function(f,a,c){function x(d){return a.def('"',d,'" in ',c,"?",b,"[",c,".",d,"]:",7680)}var b=f.constants.stencilOps;return["stencil.opBack"===d?1029:1028,x("fail"),x("zfail"),x("zpass")]});case "polygonOffset.offset":return f(function(d){return[d.factor|0,d.units|0]},function(d,
f,a){d=f.def(a,".factor|0");f=f.def(a,".units|0");return[d,f]});case "cull.face":return f(function(d){var f=0;"front"===d?f=1028:"back"===d&&(f=1029);return f},function(d,f,a){return f.def(a,'==="front"?',1028,":",1029)});case "lineWidth":return f(function(d){return d},function(d,f,a){return a});case "frontFace":return f(function(d){return L[d]},function(d,f,a){return f.def(a+'==="cw"?2304:2305')});case "colorMask":return f(function(d){return d.map(function(d){return!!d})},function(d,f,a){return F(4,
function(d){return"!!"+a+"["+d+"]"})});case "sample.coverage":return f(function(d){return["value"in d?d.value:1,!!d.invert]},function(d,f,a){d=f.def('"value" in ',a,"?+",a,".value:1");f=f.def("!!",a,".invert");return[d,f]})}});return h}function qa(d,f){var b=d["static"],q=d.dynamic,h={};Object.keys(b).forEach(function(d){var f=b[d],a;if("number"===typeof f||"boolean"===typeof f)a=c(function(){return f});else if("function"===typeof f){var x=f._reglType;if("texture2d"===x||"textureCube"===x)a=c(function(d){return d.link(f)});
else if("framebuffer"===x||"framebufferCube"===x)a=c(function(d){return d.link(f.color[0])})}else z(f)&&(a=c(function(d){return d.global.def("[",F(f.length,function(d){return f[d]}),"]")}));a.value=f;h[d]=a});Object.keys(q).forEach(function(d){var f=q[d];h[d]=a(f,function(d,a){return d.invoke(a,f)})});return h}function ja(d,f){var b=d["static"],q=d.dynamic,h={};Object.keys(b).forEach(function(d){var f=b[d],a=e.id(d),x=new Aa;if(p(f))x.state=1,x.buffer=K.getBuffer(K.create(f,34962,!1,!0)),x.type=0;
else{var q=K.getBuffer(f);if(q)x.state=1,x.buffer=q,x.type=0;else if(f.constant){var l=f.constant;x.buffer="null";x.state=2;"number"===typeof l?x.x=l:N.forEach(function(d,f){f<l.length&&(x[d]=l[f])})}else{var q=p(f.buffer)?K.getBuffer(K.create(f.buffer,34962,!1,!0)):K.getBuffer(f.buffer),k=f.offset|0,g=f.stride|0,u=f.size|0,m=!!f.normalized,Pa=0;"type"in f&&(Pa=C[f.type]);f=f.divisor|0;x.buffer=q;x.state=1;x.size=u;x.normalized=m;x.type=Pa||q.dtype;x.offset=k;x.stride=g;x.divisor=f}}h[d]=c(function(d,
f){var c=d.attribCache;if(a in c)return c[a];var b={isStream:!1};Object.keys(x).forEach(function(d){b[d]=x[d]});x.buffer&&(b.buffer=d.link(x.buffer),b.type=b.type||b.buffer+".dtype");return c[a]=b})});Object.keys(q).forEach(function(d){var f=q[d];h[d]=a(f,function(d,a){function x(d){a(l[d],"=",c,".",d,"|0;")}var c=d.invoke(a,f),b=d.shared,q=b.isBufferArgs,h=b.buffer,l={isStream:a.def(!1)},k=new Aa;k.state=1;Object.keys(k).forEach(function(d){l[d]=a.def(""+k[d])});var W=l.buffer,g=l.type;a("if(",q,
"(",c,")){",l.isStream,"=true;",W,"=",h,".createStream(",34962,",",c,");",g,"=",W,".dtype;","}else{",W,"=",h,".getBuffer(",c,");","if(",W,"){",g,"=",W,".dtype;",'}else if("constant" in ',c,"){",l.state,"=",2,";","if(typeof "+c+'.constant === "number"){',l[N[0]],"=",c,".constant;",N.slice(1).map(function(d){return l[d]}).join("="),"=0;","}else{",N.map(function(d,f){return l[d]+"="+c+".constant.length>="+f+"?"+c+".constant["+f+"]:0;"}).join(""),"}}else{","if(",q,"(",c,".buffer)){",W,"=",h,".createStream(",
34962,",",c,".buffer);","}else{",W,"=",h,".getBuffer(",c,".buffer);","}",g,'="type" in ',c,"?",b.glTypes,"[",c,".type]:",W,".dtype;",l.normalized,"=!!",c,".normalized;");x("size");x("offset");x("stride");x("divisor");a("}}");a.exit("if(",l.isStream,"){",h,".destroyStream(",W,");","}");return l})});return h}function Z(d){var f=d["static"],b=d.dynamic,q={};Object.keys(f).forEach(function(d){var a=f[d];q[d]=c(function(d,f){return"number"===typeof a||"boolean"===typeof a?""+a:d.link(a)})});Object.keys(b).forEach(function(d){var f=
b[d];q[d]=a(f,function(d,a){return d.invoke(a,f)})});return q}function ra(d,f,a,c,b){var q=la(d,b),h=xa(d,q,b),l=ha(d,b),k=ia(d,b),g=R(d,b),u=h.viewport;u&&(k.viewport=u);u=X("scissor.box");(h=h[u])&&(k[u]=h);h=0<Object.keys(k).length;q={framebuffer:q,draw:l,shader:g,state:k,dirty:h};q.profile=Ea(d,b);q.uniforms=qa(a,b);q.attributes=ja(f,b);q.context=Z(c,b);return q}function ca(d,f,a){var c=d.shared.context,b=d.scope();Object.keys(a).forEach(function(q){f.save(c,"."+q);b(c,".",q,"=",a[q].append(d,
f),";")});f(b)}function J(d,f,a,c){var b=d.shared,q=b.gl,h=b.framebuffer,l;ma&&(l=f.def(b.extensions,".webgl_draw_buffers"));var k=d.constants,b=k.drawBuffer,k=k.backBuffer;d=a?a.append(d,f):f.def(h,".next");c||f("if(",d,"!==",h,".cur){");f("if(",d,"){",q,".bindFramebuffer(",36160,",",d,".framebuffer);");ma&&f(l,".drawBuffersWEBGL(",b,"[",d,".colorAttachments.length]);");f("}else{",q,".bindFramebuffer(",36160,",null);");ma&&f(l,".drawBuffersWEBGL(",k,");");f("}",h,".cur=",d,";");c||f("}")}function na(d,
a,c){var b=d.shared,q=b.gl,h=d.current,k=d.next,g=b.current,u=b.next,m=d.cond(g,".dirty");l.forEach(function(a){a=X(a);if(!(a in c.state)){var x,b;if(a in k){x=k[a];b=h[a];var l=F(f[a].length,function(d){return m.def(x,"[",d,"]")});m(d.cond(l.map(function(d,f){return d+"!=="+b+"["+f+"]"}).join("||")).then(q,".",wa[a],"(",l,");",l.map(function(d,f){return b+"["+f+"]="+d}).join(";"),";"))}else x=m.def(u,".",a),l=d.cond(x,"!==",g,".",a),m(l),a in va?l(d.cond(x).then(q,".enable(",va[a],");")["else"](q,
".disable(",va[a],");"),g,".",a,"=",x,";"):l(q,".",wa[a],"(",x,");",g,".",a,"=",x,";")}});0===Object.keys(c.state).length&&m(g,".dirty=false;");a(m)}function da(d,f,a,c){var b=d.shared,q=d.current,h=b.current,l=b.gl;g(Object.keys(a)).forEach(function(b){var k=a[b];if(!c||c(k)){var g=k.append(d,f);if(va[b]){var u=va[b];v(k)?g?f(l,".enable(",u,");"):f(l,".disable(",u,");"):f(d.cond(g).then(l,".enable(",u,");")["else"](l,".disable(",u,");"));f(h,".",b,"=",g,";")}else if(z(g)){var m=q[b];f(l,".",wa[b],
"(",g,");",g.map(function(d,f){return m+"["+f+"]="+d}).join(";"),";")}else f(l,".",wa[b],"(",g,");",h,".",b,"=",g,";")}})}function P(d,f){sa&&(d.instancing=f.def(d.shared.extensions,".angle_instanced_arrays"))}function S(d,f,a,c,b){function q(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function h(d){p=f.def();d(p,"=",q(),";");"string"===typeof b?d(u,".count+=",b,";"):d(u,".count++;");fa&&(c?(n=f.def(),d(n,"=",e,".getNumPendingQueries();")):d(e,".beginQuery(",u,");"))}
function l(d){d(u,".cpuTime+=",q(),"-",p,";");fa&&(c?d(e,".pushScopeStats(",n,",",e,".getNumPendingQueries(),",u,");"):d(e,".endQuery();"))}function k(d){var a=f.def(m,".profile");f(m,".profile=",d,";");f.exit(m,".profile=",a,";")}var g=d.shared,u=d.stats,m=g.current,e=g.timer;a=a.profile;var p,n;if(a){if(v(a)){a.enable?(h(f),l(f.exit),k("true")):k("false");return}a=a.append(d,f);k(a)}else a=f.def(m,".profile");g=d.block();h(g);f("if(",a,"){",g,"}");d=d.block();l(d);f.exit("if(",a,"){",d,"}")}function T(d,
f,a,c,b){function q(d){switch(d){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(a,c,b){function q(){f("if(!",m,".buffer){",g,".enableVertexAttribArray(",u,");}");var a=b.type,h;h=b.size?f.def(b.size,"||",c):c;f("if(",m,".type!==",a,"||",m,".size!==",h,"||",p.map(function(d){return m+"."+d+"!=="+b[d]}).join("||"),"){",g,".bindBuffer(",34962,",",e,".buffer);",g,".vertexAttribPointer(",[u,h,a,
b.normalized,b.stride,b.offset],");",m,".type=",a,";",m,".size=",h,";",p.map(function(d){return m+"."+d+"="+b[d]+";"}).join(""),"}");sa&&(a=b.divisor,f("if(",m,".divisor!==",a,"){",d.instancing,".vertexAttribDivisorANGLE(",[u,a],");",m,".divisor=",a,";}"))}function k(){f("if(",m,".buffer){",g,".disableVertexAttribArray(",u,");","}if(",N.map(function(d,f){return m+"."+d+"!=="+W[f]}).join("||"),"){",g,".vertexAttrib4f(",u,",",W,");",N.map(function(d,f){return m+"."+d+"="+W[f]+";"}).join(""),"}")}var g=
l.gl,u=f.def(a,".location"),m=f.def(l.attributes,"[",u,"]");a=b.state;var e=b.buffer,W=[b.x,b.y,b.z,b.w],p=["buffer","normalized","offset","stride"];1===a?q():2===a?k():(f("if(",a,"===",1,"){"),q(),f("}else{"),k(),f("}"))}var l=d.shared;c.forEach(function(c){var l=c.name,k=a.attributes[l],g;if(k){if(!b(k))return;g=k.append(d,f)}else{if(!b(E))return;var u=d.scopeAttrib(l);g={};Object.keys(new Aa).forEach(function(d){g[d]=f.def(u,".",d)})}h(d.link(c),q(c.info.type),g)})}function aa(d,f,a,c,b){for(var q=
d.shared,h=q.gl,l,k=0;k<c.length;++k){var g=c[k],u=g.name,m=g.info.type,p=a.uniforms[u],g=d.link(g)+".location",n;if(p){if(!b(p))continue;if(v(p)){u=p.value;if(35678===m||35680===m)m=d.link(u._texture||u.color[0]._texture),f(h,".uniform1i(",g,",",m+".bind());"),f.exit(m,".unbind();");else if(35674===m||35675===m||35676===m)u=d.global.def("new Float32Array(["+Array.prototype.slice.call(u)+"])"),p=2,35675===m?p=3:35676===m&&(p=4),f(h,".uniformMatrix",p,"fv(",g,",false,",u,");");else{switch(m){case 5126:l=
"1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:l="1i";break;case 5124:l="1i";break;case 35671:l="2i";break;case 35667:l="2i";break;case 35672:l="3i";break;case 35668:l="3i";break;case 35673:l="4i";break;case 35669:l="4i"}f(h,".uniform",l,"(",g,",",z(u)?Array.prototype.slice.call(u):u,");")}continue}else n=p.append(d,f)}else{if(!b(E))continue;n=f.def(q.uniforms,"[",e.id(u),"]")}35678===m?f("if(",n,"&&",n,'._reglType==="framebuffer"){',n,"=",n,".color[0];",
"}"):35680===m&&f("if(",n,"&&",n,'._reglType==="framebufferCube"){',n,"=",n,".color[0];","}");u=1;switch(m){case 35678:case 35680:m=f.def(n,"._texture");f(h,".uniform1i(",g,",",m,".bind());");f.exit(m,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";u=2;break;case 35668:case 35672:l="3i";u=3;break;case 35669:case 35673:l="4i";u=4;break;case 5126:l="1f";break;case 35664:l="2f";u=2;break;case 35665:l="3f";u=3;break;case 35666:l="4f";u=4;break;case 35674:l="Matrix2fv";
break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}f(h,".uniform",l,"(",g,",");if("M"===l.charAt(0)){var g=Math.pow(m-35674+2,2),r=d.global.def("new Float32Array(",g,")");f("false,(Array.isArray(",n,")||",n," instanceof Float32Array)?",n,":(",F(g,function(d){return r+"["+d+"]="+n+"["+d+"]"}),",",r,")")}else 1<u?f(F(u,function(d){return n+"["+d+"]"})):f(n);f(");")}}function ka(d,f,a,c){function b(q){var l=k[q];return l?l.contextDep&&c.contextDynamic||l.propDep?l.append(d,a):l.append(d,f):
f.def(u,".",q)}function q(){function d(){a(B,".drawElementsInstancedANGLE(",[e,p,y,n+"<<(("+y+"-5121)>>1)",r],");")}function f(){a(B,".drawArraysInstancedANGLE(",[e,n,p,r],");")}m?I?d():(a("if(",m,"){"),d(),a("}else{"),f(),a("}")):f()}function l(){function d(){a(g+".drawElements("+[e,p,y,n+"<<(("+y+"-5121)>>1)"]+");")}function f(){a(g+".drawArrays("+[e,n,p]+");")}m?I?d():(a("if(",m,"){"),d(),a("}else{"),f(),a("}")):f()}var h=d.shared,g=h.gl,u=h.draw,k=c.draw,m=function(){var b=k.elements,q=f;if(b){if(b.contextDep&&
c.contextDynamic||b.propDep)q=a;b=b.append(d,q)}else b=q.def(u,".","elements");b&&q("if("+b+")"+g+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),e=b("primitive"),n=b("offset"),p=function(){var b=k.count,q=f;if(b){if(b.contextDep&&c.contextDynamic||b.propDep)q=a;b=b.append(d,q)}else b=q.def(u,".","count");return b}();if("number"===typeof p){if(0===p)return}else a("if(",p,"){"),a.exit("}");var r,B;sa&&(r=b("instances"),B=d.instancing);var y=m+".type",I=k.elements&&v(k.elements);sa&&("number"!==
typeof r||0<=r)?"string"===typeof r?(a("if(",r,">0){"),q(),a("}else if(",r,"<0){"),l(),a("}")):q():l()}function ta(d,f,a,b,c){f=M();c=f.proc("body",c);sa&&(f.instancing=c.def(f.shared.extensions,".angle_instanced_arrays"));d(f,c,a,b);return f.compile().body}function oa(d,f,a,b){P(d,f);T(d,f,a,b.attributes,function(){return!0});aa(d,f,a,b.uniforms,function(){return!0});ka(d,f,f,a)}function Ga(d,f){var a=d.proc("draw",1);P(d,a);ca(d,a,f.context);J(d,a,f.framebuffer);na(d,a,f);da(d,a,f.state);S(d,a,
f,!1,!0);var b=f.shader.progVar.append(d,a);a(d.shared.gl,".useProgram(",b,".program);");if(f.shader.program)oa(d,a,f,f.shader.program);else{var c=d.global.def("{}"),q=a.def(b,".id"),l=a.def(c,"[",q,"]");a(d.cond(l).then(l,".call(this,a0);")["else"](l,"=",c,"[",q,"]=",d.link(function(a){return ta(oa,d,f,a,1)}),"(",b,");",l,".call(this,a0);"))}0<Object.keys(f.state).length&&a(d.shared.current,".dirty=true;")}function Ha(f,a,b,c){function q(){return!0}f.batchId="a1";P(f,a);T(f,a,b,c.attributes,q);aa(f,
a,b,c.uniforms,q);ka(f,a,a,b)}function Ba(f,a,b,c){function q(f){return f.contextDep&&h||f.propDep}function l(f){return!q(f)}P(f,a);var h=b.contextDep,g=a.def(),u=a.def();f.shared.props=u;f.batchId=g;var k=f.scope(),m=f.scope();a(k.entry,"for(",g,"=0;",g,"<","a1",";++",g,"){",u,"=","a0","[",g,"];",m,"}",k.exit);b.needsContext&&ca(f,m,b.context);b.needsFramebuffer&&J(f,m,b.framebuffer);da(f,m,b.state,q);b.profile&&q(b.profile)&&S(f,m,b,!1,!0);c?(T(f,k,b,c.attributes,l),T(f,m,b,c.attributes,q),aa(f,
k,b,c.uniforms,l),aa(f,m,b,c.uniforms,q),ka(f,k,m,b)):(a=f.global.def("{}"),c=b.shader.progVar.append(f,m),u=m.def(c,".id"),k=m.def(a,"[",u,"]"),m(f.shared.gl,".useProgram(",c,".program);","if(!",k,"){",k,"=",a,"[",u,"]=",f.link(function(a){return ta(Ha,f,b,a,2)}),"(",c,");}",k,".call(this,a0[",g,"],",g,");"))}function Ca(f,a){function b(f){return f.contextDep&&q||f.propDep}var c=f.proc("batch",2);f.batchId="0";P(f,c);var q=!1,l=!0;Object.keys(a.context).forEach(function(f){q=q||a.context[f].propDep});
q||(ca(f,c,a.context),l=!1);var h=a.framebuffer,g=!1;h?(h.propDep?q=g=!0:h.contextDep&&q&&(g=!0),g||J(f,c,h)):J(f,c,null);a.state.viewport&&a.state.viewport.propDep&&(q=!0);na(f,c,a);da(f,c,a.state,function(f){return!b(f)});a.profile&&b(a.profile)||S(f,c,a,!1,"a1");a.contextDep=q;a.needsContext=l;a.needsFramebuffer=g;l=a.shader.progVar;if(l.contextDep&&q||l.propDep)Ba(f,c,a,null);else if(l=l.append(f,c),c(f.shared.gl,".useProgram(",l,".program);"),a.shader.program)Ba(f,c,a,a.shader.program);else{var h=
f.global.def("{}"),g=c.def(l,".id"),m=c.def(h,"[",g,"]");c(f.cond(m).then(m,".call(this,a0,a1);")["else"](m,"=",h,"[",g,"]=",f.link(function(b){return ta(Ba,f,a,b,2)}),"(",l,");",m,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&c(f.shared.current,".dirty=true;")}function Oa(f,a){function b(l){var h=a.shader[l];h&&c.set(q.shader,"."+l,h.append(f,c))}var c=f.proc("scope",3);f.batchId="a2";var q=f.shared,l=q.current;ca(f,c,a.context);a.framebuffer&&a.framebuffer.append(f,c);g(Object.keys(a.state)).forEach(function(b){var l=
a.state[b].append(f,c);z(l)?l.forEach(function(a,q){c.set(f.next[b],"["+q+"]",a)}):c.set(q.next,"."+b,l)});S(f,c,a,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var l=a.draw[b];l&&c.set(q.draw,"."+b,""+l.append(f,c))});Object.keys(a.uniforms).forEach(function(b){c.set(q.uniforms,"["+e.id(b)+"]",a.uniforms[b].append(f,c))});Object.keys(a.attributes).forEach(function(b){var q=a.attributes[b].append(f,c),l=f.scopeAttrib(b);Object.keys(new Aa).forEach(function(f){c.set(l,
"."+f,q[f])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(l,".dirty=true;"),c.exit(l,".dirty=true;"));c("a1(",f.shared.context,",a0,",f.batchId,");")}function Ma(f){if("object"===typeof f&&!z(f)){for(var a=Object.keys(f),b=0;b<a.length;++b)if(r.isDynamic(f[a[b]]))return!0;return!1}}function Ia(f,b,c){function q(f,a){g.forEach(function(d){var b=l[d];r.isDynamic(b)&&(b=f.invoke(a,b),a(e,".",d,"=",b,";"))})}var l=b["static"][c];if(l&&Ma(l)){var h=f.global,g=Object.keys(l),m=!1,k=!1,u=!1,
e=f.global.def("{}");g.forEach(function(b){var c=l[b];if(r.isDynamic(c))"function"===typeof c&&(c=l[b]=r.unbox(c)),b=a(c,null),m=m||b.thisDep,u=u||b.propDep,k=k||b.contextDep;else{h(e,".",b,"=");switch(typeof c){case "number":h(c);break;case "string":h('"',c,'"');break;case "object":Array.isArray(c)&&h("[",c.join(),"]");break;default:h(f.link(c))}h(";")}});b.dynamic[c]=new r.DynamicVariable(4,{thisDep:m,contextDep:k,propDep:u,ref:e,append:q});delete b["static"][c]}}var Aa=za.Record,Y={add:32774,subtract:32778,
"reverse subtract":32779};n.ext_blend_minmax&&(Y.min=32775,Y.max=32776);var sa=n.angle_instanced_arrays,ma=n.webgl_draw_buffers,f={dirty:!0,profile:ga.profile},q={},l=[],va={},wa={};Q("dither",3024);Q("blend.enable",3042);H("blend.color","blendColor",[0,0,0,0]);H("blend.equation","blendEquationSeparate",[32774,32774]);H("blend.func","blendFuncSeparate",[1,0,1,0]);Q("depth.enable",2929,!0);H("depth.func","depthFunc",513);H("depth.range","depthRange",[0,1]);H("depth.mask","depthMask",!0);H("colorMask",
"colorMask",[!0,!0,!0,!0]);Q("cull.enable",2884);H("cull.face","cullFace",1029);H("frontFace","frontFace",2305);H("lineWidth","lineWidth",1);Q("polygonOffset.enable",32823);H("polygonOffset.offset","polygonOffset",[0,0]);Q("sample.alpha",32926);Q("sample.enable",32928);H("sample.coverage","sampleCoverage",[1,!1]);Q("stencil.enable",2960);H("stencil.mask","stencilMask",-1);H("stencil.func","stencilFunc",[519,0,-1]);H("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);H("stencil.opBack","stencilOpSeparate",
[1029,7680,7680,7680]);Q("scissor.enable",3089);H("scissor.box","scissor",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);H("viewport","viewport",[0,0,h.drawingBufferWidth,h.drawingBufferHeight]);var Qa={gl:h,context:u,strings:e,next:q,current:f,draw:ea,elements:w,buffer:K,shader:ua,attributes:za.state,uniforms:I,framebuffer:A,extensions:n,timer:fa,isBufferArgs:p},La={primTypes:D,compareFuncs:B,blendFuncs:m,blendEquations:Y,stencilOps:U,glTypes:C,orientationType:L};ma&&(La.backBuffer=[1029],La.drawBuffer=
F(t.maxDrawbuffers,function(f){return 0===f?[0]:F(f,function(f){return 36064+f})}));var Ra=0;return{next:q,current:f,procs:function(){var a=M(),b=a.proc("poll"),c=a.proc("refresh"),q=a.block();b(q);c(q);var l=a.shared,g=l.gl,m=l.next,k=l.current;q(k,".dirty=false;");J(a,b);J(a,c,null,!0);var u=h.getExtension("angle_instanced_arrays"),e;u&&(e=a.link(u));for(var p=0;p<t.maxAttributes;++p){var n=c.def(l.attributes,"[",p,"]"),r=a.cond(n,".buffer");r.then(g,".enableVertexAttribArray(",p,");",g,".bindBuffer(",
34962,",",n,".buffer.buffer);",g,".vertexAttribPointer(",p,",",n,".size,",n,".type,",n,".normalized,",n,".stride,",n,".offset);")["else"](g,".disableVertexAttribArray(",p,");",g,".vertexAttrib4f(",p,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");c(r);u&&c(e,".vertexAttribDivisorANGLE(",p,",",n,".divisor);")}Object.keys(va).forEach(function(f){var l=va[f],h=q.def(m,".",f),u=a.block();u("if(",h,"){",g,".enable(",l,")}else{",g,".disable(",l,")}",k,".",f,"=",h,";");c(u);b("if(",h,"!==",k,".",
f,"){",u,"}")});Object.keys(wa).forEach(function(l){var h=wa[l],u=f[l],n,e,p=a.block();p(g,".",h,"(");z(u)?(h=u.length,n=a.global.def(m,".",l),e=a.global.def(k,".",l),p(F(h,function(f){return n+"["+f+"]"}),");",F(h,function(f){return e+"["+f+"]="+n+"["+f+"];"}).join("")),b("if(",F(h,function(f){return n+"["+f+"]!=="+e+"["+f+"]"}).join("||"),"){",p,"}")):(n=q.def(m,".",l),e=q.def(k,".",l),p(n,");",k,".",l,"=",n,";"),b("if(",n,"!==",e,"){",p,"}"));c(p)});return a.compile()}(),compile:function(f,a,b,
c,l){var q=M();q.stats=q.link(l);Object.keys(a["static"]).forEach(function(f){Ia(q,a,f)});k.forEach(function(a){Ia(q,f,a)});b=ra(f,a,b,c,q);Ga(q,b);Oa(q,b);Ca(q,b);return q.compile()}}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./dynamic":8,"./util/codegen":21,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],8:[function(e,t,w){function p(c,a){this.id=v++;this.type=c;this.data=a}function g(c){if(0===c.length)return[];var a=c.charAt(0),
b=c.charAt(c.length-1);if(1<c.length&&a===b&&('"'===a||"'"===a))return['"'+c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return g(c.substr(0,a.index)).concat(g(a[1])).concat(g(c.substr(a.index+a[0].length)));a=c.split(".");if(1===a.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<a.length;++b)c=c.concat(g(a[b]));return c}function y(c){return"["+g(c).join("][")+"]"}var v=0;t.exports={DynamicVariable:p,
define:function(c,a){return new p(c,y(a+""))},isDynamic:function(c){return"function"===typeof c&&!c._reglType||c instanceof p},unbox:function(c,a){return"function"===typeof c?new p(0,c):c},accessor:y}},{}],9:[function(e,t,w){var p=e("./util/is-typed-array"),g=e("./util/is-ndarray"),y=e("./util/values"),v=e("./constants/primitives.json"),c=e("./constants/usage.json");t.exports=function(a,b,e,t){function n(a){this.id=C++;D[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function z(c,
k,n,r,v,h,y){c.buffer.bind();if(k){var z=y;y||p(k)&&(!g(k)||p(k.data))||(z=b.oes_element_index_uint?5125:5123);e._initBuffer(c.buffer,k,n,z,3)}else a.bufferData(34963,h,n),c.buffer.dtype=z||5121,c.buffer.usage=n,c.buffer.dimension=3,c.buffer.byteLength=h;z=y;if(!y){switch(c.buffer.dtype){case 5121:case 5120:z=5121;break;case 5123:case 5122:z=5123;break;case 5125:case 5124:z=5125}c.buffer.dtype=z}c.type=z;k=v;0>k&&(k=c.buffer.byteLength,5123===z?k>>=1:5125===z&&(k>>=2));c.vertCount=k;k=r;0>r&&(k=4,
r=c.buffer.dimension,1===r&&(k=0),2===r&&(k=1),3===r&&(k=4));c.primType=k}function r(a){t.elementsCount--;delete D[a.id];a.buffer.destroy();a.buffer=null}var D={},C=0,N={uint8:5121,uint16:5123};b.oes_element_index_uint&&(N.uint32=5125);n.prototype.bind=function(){this.buffer.bind()};var k=[];return{create:function(a,b){function k(a){if(a)if("number"===typeof a)y(a),C.primType=4,C.vertCount=a|0,C.type=5121;else{var b=null,m=35044,n=-1,e=-1,r=0,B=0;if(Array.isArray(a)||p(a)||g(a))b=a;else if("data"in
a&&(b=a.data),"usage"in a&&(m=c[a.usage]),"primitive"in a&&(n=v[a.primitive]),"count"in a&&(e=a.count|0),"type"in a&&(B=N[a.type]),"length"in a)r=a.length|0;else if(r=e,5123===B||5122===B)r*=2;else if(5125===B||5124===B)r*=4;z(C,b,m,n,e,r,B)}else y(),C.primType=4,C.vertCount=0,C.type=5121;return k}var y=e.create(null,34963,!0),C=new n(y._buffer);t.elementsCount++;k(a);k._reglType="elements";k._elements=C;k.subdata=function(a,b){y.subdata(a,b);return k};k.destroy=function(){r(C)};return k},createStream:function(a){var b=
k.pop();b||(b=new n(e.create(null,34963,!0,!1)._buffer));z(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){k.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof n?a._elements:null},clear:function(){y(D).forEach(r)}}}},{"./constants/primitives.json":5,"./constants/usage.json":6,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],10:[function(e,t,w){t.exports=function(e,g){function y(a){a=a.toLowerCase();var c;try{c=v[a]=e.getExtension(a)}catch(g){}return!!c}
for(var v={},c=0;c<g.extensions.length;++c){var a=g.extensions[c];if(!y(a))return g.onDestroy(),g.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}g.optionalExtensions.forEach(y);return{extensions:v,restore:function(){Object.keys(v).forEach(function(a){if(!y(a))throw Error("(regl): error restoring extension "+a);})}}}},{}],11:[function(e,t,w){var p=e("./util/values"),g=e("./util/extend"),y=[];y[6408]=4;var v=[];v[5121]=
1;v[5126]=4;v[36193]=2;t.exports=function(c,a,b,e,t,n){function z(a,c,b){this.target=a;this.texture=c;this.renderbuffer=b;var h=a=0;c?(a=c.width,h=c.height):b&&(a=b.width,h=b.height);this.width=a;this.height=h}function r(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function D(a,c,b){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function C(a,b){b&&(b.texture?c.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,
0):c.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}function N(a){var b=3553,c=null,h=null,k=a;"object"===typeof a&&(k=a.data,"target"in a&&(b=a.target|0));a=k._reglType;"texture2d"===a?c=k:"textureCube"===a?c=k:"renderbuffer"===a&&(h=k,b=36161);return new z(b,c,h)}function k(a,b,c,h,k){if(c)return a=e.create2D({width:a,height:b,format:h,type:k}),a._texture.refCount=0,new z(3553,a,null);a=t.create({width:a,height:b,format:h});a._renderbuffer.refCount=0;return new z(36161,
null,a)}function m(a){return a&&(a.texture||a.renderbuffer)}function B(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function w(){this.id=V++;A[this.id]=this;this.framebuffer=c.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function L(a){a.colorAttachments.forEach(r);r(a.depthAttachment);r(a.stencilAttachment);r(a.depthStencilAttachment)}function E(a){c.deleteFramebuffer(a.framebuffer);
a.framebuffer=null;n.framebufferCount--;delete A[a.id]}function h(a){var h;c.bindFramebuffer(36160,a.framebuffer);var k=a.colorAttachments;for(h=0;h<k.length;++h)C(36064+h,k[h]);for(h=k.length;h<b.maxColorAttachments;++h)c.framebufferTexture2D(36160,36064+h,3553,null,0);c.framebufferTexture2D(36160,33306,3553,null,0);c.framebufferTexture2D(36160,36096,3553,null,0);c.framebufferTexture2D(36160,36128,3553,null,0);C(36096,a.depthAttachment);C(36128,a.stencilAttachment);C(33306,a.depthStencilAttachment);
c.checkFramebufferStatus(36160);c.bindFramebuffer(36160,Fa.next);Fa.cur=Fa.next;c.getError()}function ba(a,b){function c(a,b){var g,n=0,p=0,r=!0,z=!0;g=null;var C=!0,B="rgba",t="uint8",F=1,E=null,K=null,w=null,U=!1;if("number"===typeof a)n=a|0,p=b|0||n;else if(a){"shape"in a?(p=a.shape,n=p[0],p=p[1]):("radius"in a&&(n=p=a.radius),"width"in a&&(n=a.width),"height"in a&&(p=a.height));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g);if(!g){"colorCount"in a&&(F=a.colorCount|0);"colorTexture"in
a&&(C=!!a.colorTexture,B="rgba4");if("colorType"in a&&(t=a.colorType,!C))if("half float"===t||"float16"===t)B="rgba16f";else if("float"===t||"float32"===t)B="rgba32f";"colorFormat"in a&&(B=a.colorFormat,0<=Ja.indexOf(B)?C=!0:0<=ya.indexOf(B)&&(C=!1))}if("depthTexture"in a||"depthStencilTexture"in a)U=!(!a.depthTexture&&!a.depthStencilTexture);"depth"in a&&("boolean"===typeof a.depth?r=a.depth:(E=a.depth,z=!1));"stencil"in a&&("boolean"===typeof a.stencil?z=a.stencil:(K=a.stencil,r=!1));"depthStencil"in
a&&("boolean"===typeof a.depthStencil?r=z=a.depthStencil:(w=a.depthStencil,z=r=!1))}else n=p=1;var A=null,ba=null,I=null,J=null;if(Array.isArray(g))A=g.map(N);else if(g)A=[N(g)];else for(A=Array(F),g=0;g<F;++g)A[g]=k(n,p,C,B,t);n=n||A[0].width;p=p||A[0].height;E?ba=N(E):r&&!z&&(ba=k(n,p,U,"depth","uint32"));K?I=N(K):z&&!r&&(I=k(n,p,!1,"stencil","uint8"));w?J=N(w):!E&&!K&&z&&r&&(J=k(n,p,U,"depth stencil","depth stencil"));r=null;for(g=0;g<A.length;++g)D(A[g],n,p),A[g]&&A[g].texture&&(z=y[A[g].texture._texture.format]*
v[A[g].texture._texture.type],null===r&&(r=z));D(ba,n,p);D(I,n,p);D(J,n,p);L(e);e.width=n;e.height=p;e.colorAttachments=A;e.depthAttachment=ba;e.stencilAttachment=I;e.depthStencilAttachment=J;c.color=A.map(m);c.depth=m(ba);c.stencil=m(I);c.depthStencil=m(J);c.width=e.width;c.height=e.height;h(e);return c}var e=new w;n.framebufferCount++;c(a,b);return g(c,{resize:function(a,b){var k=a|0,g=b|0||k;if(k===e.width&&g===e.height)return c;for(var m=e.colorAttachments,n=0;n<m.length;++n)B(m[n],k,g);B(e.depthAttachment,
k,g);B(e.stencilAttachment,k,g);B(e.depthStencilAttachment,k,g);e.width=c.width=k;e.height=c.height=g;h(e);return c},_reglType:"framebuffer",_framebuffer:e,destroy:function(){E(e);L(e)},bind:function(a){Fa.setFBO({framebuffer:c},a)}})}var Fa={cur:null,next:null,dirty:!1,setFBO:null},Ja=["rgba"],ya=["rgba4","rgb565","rgb5 a1"];a.ext_srgb&&ya.push("srgba");a.ext_color_buffer_half_float&&ya.push("rgba16f","rgb16f");a.webgl_color_buffer_float&&ya.push("rgba32f");var Da=["uint8"];a.oes_texture_half_float&&
Da.push("half float","float16");a.oes_texture_float&&Da.push("float","float32");var V=0,A={};return g(Fa,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof w)?a:null},create:ba,createCube:function(a){function c(a){var h,k={color:null},n=0,m=null;h="rgba";var p="uint8",r=1;if("number"===typeof a)n=a|0;else if(a){"shape"in a?n=a.shape[0]:("radius"in a&&(n=a.radius|0),"width"in a?n=a.width|0:"height"in a&&(n=a.height|0));if("color"in a||
"colors"in a)m=a.color||a.colors,Array.isArray(m);m||("colorCount"in a&&(r=a.colorCount|0),"colorType"in a&&(p=a.colorType),"colorFormat"in a&&(h=a.colorFormat));"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else n=1;if(m)if(Array.isArray(m))for(a=[],h=0;h<m.length;++h)a[h]=m[h];else a=[m];else for(a=Array(r),m={radius:n,format:h,type:p},h=0;h<r;++h)a[h]=e.createCube(m);k.color=Array(a.length);for(h=0;h<a.length;++h)r=a[h],
n=n||r.width,k.color[h]={target:34069,data:a[h]};for(h=0;6>h;++h){for(r=0;r<a.length;++r)k.color[r].target=34069+h;0<h&&(k.depth=b[0].depth,k.stencil=b[0].stencil,k.depthStencil=b[0].depthStencil);if(b[h])b[h](k);else b[h]=ba(k)}return g(c,{width:n,height:n,color:a})}var b=Array(6);c(a);return g(c,{faces:b,resize:function(a){var h=a|0;if(h===c.width)return c;var k=c.color;for(a=0;a<k.length;++a)k[a].resize(h);for(a=0;6>a;++a)b[a].resize(h);c.width=c.height=h;return c},_reglType:"framebufferCube",
destroy:function(){b.forEach(function(a){a.destroy()})}})},clear:function(){p(A).forEach(E)},restore:function(){p(A).forEach(function(a){a.framebuffer=c.createFramebuffer();h(a)})}})}},{"./util/extend":22,"./util/values":31}],12:[function(e,t,w){t.exports=function(e,g){var y=1;g.ext_texture_filter_anisotropic&&(y=e.getParameter(34047));var v=1,c=1;g.webgl_draw_buffers&&(v=e.getParameter(34852),c=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),
e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(g).filter(function(a){return!!g[a]}),maxAnisotropic:y,maxDrawbuffers:v,maxColorAttachments:c,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),
maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],13:[function(e,t,w){var p=e("./util/is-typed-array");t.exports=function(g,e,v,c,a,b){function t(a){var b;b=null===e.next?5121:e.next.colorAttachments[0].texture._texture.type;
var r=0,D=0,C=c.framebufferWidth,F=c.framebufferHeight,k=null;p(a)?k=a:a&&(r=a.x|0,D=a.y|0,C=(a.width||c.framebufferWidth-r)|0,F=(a.height||c.framebufferHeight-D)|0,k=a.data||null);v();a=C*F*4;k||(5121===b?k=new Uint8Array(a):5126===b&&(k=k||new Float32Array(a)));g.pixelStorei(3333,4);g.readPixels(r,D,C,F,6408,b,k);return k}function K(a){var b;e.setFBO({framebuffer:a.framebuffer},function(){b=t(a)});return b}return function(a){return a&&"framebuffer"in a?K(a):t(a)}}},{"./util/is-typed-array":26}],
14:[function(e,t,w){var p=e("./util/values"),g=[];g[32854]=2;g[32855]=2;g[36194]=2;g[33189]=2;g[36168]=1;g[34041]=4;g[35907]=4;g[34836]=16;g[34842]=8;g[34843]=6;t.exports=function(e,v,c,a,b){function t(a){this.id=r++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;b.profile&&(this.stats={size:0})}function K(b){var c=b.renderbuffer;e.bindRenderbuffer(36161,null);e.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete D[b.id];a.renderbufferCount--}var n={rgba4:32854,
rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};v.ext_srgb&&(n.srgba=35907);v.ext_color_buffer_half_float&&(n.rgba16f=34842,n.rgb16f=34843);v.webgl_color_buffer_float&&(n.rgba32f=34836);var z=[];Object.keys(n).forEach(function(a){z[n[a]]=a});var r=0,D={};t.prototype.decRef=function(){0>=--this.refCount&&K(this)};b.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(D).forEach(function(b){a+=D[b].stats.size});return a});return{create:function(c,r){function k(a,
c){var r=0,p=0,h=32854;"object"===typeof a&&a?("shape"in a?(p=a.shape,r=p[0]|0,p=p[1]|0):("radius"in a&&(r=p=a.radius|0),"width"in a&&(r=a.width|0),"height"in a&&(p=a.height|0)),"format"in a&&(h=n[a.format])):"number"===typeof a?(r=a|0,p="number"===typeof c?c|0:r):a||(r=p=1);if(r!==m.width||p!==m.height||h!==m.format)return k.width=m.width=r,k.height=m.height=p,m.format=h,e.bindRenderbuffer(36161,m.renderbuffer),e.renderbufferStorage(36161,h,r,p),b.profile&&(m.stats.size=g[m.format]*m.width*m.height),
k.format=z[m.format],k}var m=new t(e.createRenderbuffer());D[m.id]=m;a.renderbufferCount++;k(c,r);k.resize=function(a,c){var n=a|0,r=c|0||n;if(n===m.width&&r===m.height)return k;k.width=m.width=n;k.height=m.height=r;e.bindRenderbuffer(36161,m.renderbuffer);e.renderbufferStorage(36161,m.format,n,r);b.profile&&(m.stats.size=g[m.format]*m.width*m.height);return k};k._reglType="renderbuffer";k._renderbuffer=m;b.profile&&(k.stats=m.stats);k.destroy=function(){m.decRef()};return k},clear:function(){p(D).forEach(K)},
restore:function(){p(D).forEach(function(a){a.renderbuffer=e.createRenderbuffer();e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)});e.bindRenderbuffer(36161,null)}}}},{"./util/values":31}],15:[function(e,t,w){var p=e("./util/values");t.exports=function(g,e,v,c){function a(a,b,c,g){this.name=a;this.id=b;this.location=c;this.info=g}function b(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function t(a,b,c){c=
35632===a?z:r;var n=c[b];if(!n){var p=e.str(b),n=g.createShader(a);g.shaderSource(n,p);g.compileShader(n);c[b]=n}return n}function K(a,b){this.id=w++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];c.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function n(k,n){var r,p;r=t(35632,k.fragId);p=t(35633,k.vertId);var v=k.program=g.createProgram();g.attachShader(v,r);g.attachShader(v,p);g.linkProgram(v);var z=g.getProgramParameter(v,35718);c.profile&&(k.stats.uniformsCount=
z);var h=k.uniforms;for(r=0;r<z;++r)if(p=g.getActiveUniform(v,r))if(1<p.size)for(var D=0;D<p.size;++D){var C=p.name.replace("[0]","["+D+"]");b(h,new a(C,e.id(C),g.getUniformLocation(v,C),p))}else b(h,new a(p.name,e.id(p.name),g.getUniformLocation(v,p.name),p));z=g.getProgramParameter(v,35721);c.profile&&(k.stats.attributesCount=z);h=k.attributes;for(r=0;r<z;++r)(p=g.getActiveAttrib(v,r))&&b(h,new a(p.name,e.id(p.name),g.getAttribLocation(v,p.name),p))}var z={},r={},D={},C=[],w=0;c.profile&&(v.getMaxUniformsCount=
function(){var a=0;C.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},v.getMaxAttributesCount=function(){var a=0;C.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=g.deleteShader.bind(g);p(z).forEach(a);z={};p(r).forEach(a);r={};C.forEach(function(a){g.deleteProgram(a.program)});C.length=0;D={};v.shaderCount=0},program:function(a,b,c){var g=D[b];g||(g=D[b]={});var e=g[a];e||(e=new K(b,a),v.shaderCount++,
n(e,c),g[a]=e,C.push(e));return e},restore:function(){z={};r={};for(var a=0;a<C.length;++a)n(C[a])},shader:t,frag:-1,vert:-1}}},{"./util/values":31}],16:[function(e,t,w){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],17:[function(e,t,w){t.exports=function(){var e={"":0},g=[""];return{id:function(t){var v=e[t];if(v)return v;v=e[t]=g.length;g.push(t);return v},str:function(e){return g[e]}}}},
{}],18:[function(e,t,w){function p(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function g(a){return Array.isArray(a)&&0!==a.length&&D(a[0])?!0:!1}function y(a){return Object.prototype.toString.call(a)}function v(a){if(!a)return!1;var b=y(a);return 0<=U.indexOf(b)?!0:p(a)||g(a)||n(a)}function c(a,b){36193===a.type?(a.data=r(b),z.freeType(b)):a.data=b}function a(a,b,c,g,e,k){a="undefined"!==typeof E[a]?E[a]:B[a]*L[b];k&&(a*=6);if(e){for(g=0;1<=c;)g+=a*c*c,c/=2;return g}return a*
c*g}var b=e("./util/extend"),F=e("./util/values"),K=e("./util/is-typed-array"),n=e("./util/is-ndarray"),z=e("./util/pool"),r=e("./util/to-half-float"),D=e("./util/is-array-like"),C=e("./util/flatten");w=e("./constants/arraytypes.json");var N=e("./constants/arraytypes.json"),k=[9984,9986,9985,9987],m=[0,6409,6410,6407,6408],B={};B[6409]=B[6406]=B[6402]=1;B[34041]=B[6410]=2;B[6407]=B[35904]=3;B[6408]=B[35906]=4;var U=Object.keys(w).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]",
"[object HTMLImageElement]","[object HTMLVideoElement]"]),L=[];L[5121]=1;L[5126]=4;L[36193]=2;L[5123]=2;L[5125]=4;var E=[];E[32854]=2;E[32855]=2;E[36194]=2;E[34041]=4;E[33776]=.5;E[33777]=.5;E[33778]=1;E[33779]=1;E[35986]=.5;E[35987]=1;E[34798]=1;E[35840]=.5;E[35841]=.25;E[35842]=.5;E[35843]=.25;E[36196]=.5;t.exports=function(h,e,t,w,E,L,V){function A(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=
this.width=this.colorSpace=0}function I(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function U(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.flipY=b.flipY);"alignment"in b&&(a.unpackAlignment=b.alignment);"colorSpace"in
b&&(a.colorSpace=P[b.colorSpace]);"type"in b&&(a.type=S[b.type]);var c=a.width,h=a.height,g=a.channels,e=!1;"shape"in b?(c=b.shape[0],h=b.shape[1],3===b.shape.length&&(g=b.shape[2],e=!0)):("radius"in b&&(c=h=b.radius),"width"in b&&(c=b.width),"height"in b&&(h=b.height),"channels"in b&&(g=b.channels,e=!0));a.width=c|0;a.height=h|0;a.channels=g|0;c=!1;"format"in b&&(c=b.format,h=a.internalformat=T[c],a.format=Oa[h],c in S&&!("type"in b)&&(a.type=S[c]),c in aa&&(a.compressed=!0),c=!0);!e&&c?a.channels=
B[a.format]:e&&!c&&a.channels!==m[a.format]&&(a.format=a.internalformat=m[a.channels])}}function ua(a){h.pixelStorei(37440,a.flipY);h.pixelStorei(37441,a.premultiplyAlpha);h.pixelStorei(37443,a.colorSpace);h.pixelStorei(3317,a.unpackAlignment)}function ea(){A.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function u(a,b){var l=null;v(b)?l=b:b&&(U(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),v(b.data)&&(l=b.data));if(b.copy){var h=
E.viewportWidth,e=E.viewportHeight;a.width=a.width||h-a.xOffset;a.height=a.height||e-a.yOffset;a.needsCopy=!0}else if(!l)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(K(l))a.channels=a.channels||4,a.data=l,"type"in b||5121!==a.type||(a.type=N[Object.prototype.toString.call(l)]|0);else if(p(l)){a.channels=a.channels||4;h=l;e=h.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:e=z.allocType(a.type,e);e.set(h);a.data=e;break;case 36193:a.data=r(h)}a.alignment=1;
a.needsFree=!0}else if(n(l)){h=l.data;Array.isArray(h)||5121!==a.type||(a.type=N[Object.prototype.toString.call(h)]|0);var e=l.shape,k=l.stride,u,t,d,x;3===e.length?(d=e[2],x=k[2]):x=d=1;u=e[0];t=e[1];e=k[0];k=k[1];a.alignment=1;a.width=u;a.height=t;a.channels=d;a.format=a.internalformat=m[d];a.needsFree=!0;u=x;l=l.offset;d=a.width;x=a.height;t=a.channels;for(var F=z.allocType(36193===a.type?5126:a.type,d*x*t),w=0,B=0;B<x;++B)for(var A=0;A<d;++A)for(var oa=0;oa<t;++oa)F[w++]=h[e*A+k*B+u*oa+l];c(a,
F)}else if("[object HTMLCanvasElement]"===y(l)||"[object CanvasRenderingContext2D]"===y(l))"[object HTMLCanvasElement]"===y(l)?a.element=l:a.element=l.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===y(l))a.element=l,a.width=l.naturalWidth,a.height=l.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===y(l))a.element=l,a.width=l.videoWidth,a.height=l.videoHeight,a.channels=4;else if(g(l)){h=a.width||l[0].length;e=a.height||l.length;
k=a.channels;k=D(l[0][0])?k||l[0][0].length:k||1;u=C.shape(l);d=1;for(x=0;x<u.length;++x)d*=u[x];d=z.allocType(36193===a.type?5126:a.type,d);C.flatten(l,u,"",d);c(a,d);a.alignment=1;a.width=h;a.height=e;a.channels=k;a.format=a.internalformat=m[k];a.needsFree=!0}}function fa(a,b,c,e,g){var k=a.element,n=a.data,r=a.internalformat,d=a.format,p=a.type,m=a.width,u=a.height;ua(a);k?h.texSubImage2D(b,g,c,e,d,p,k):a.compressed?h.compressedTexSubImage2D(b,g,c,e,r,m,u,n):a.needsCopy?(w(),h.copyTexSubImage2D(b,
g,c,e,a.xOffset,a.yOffset,m,u)):h.texSubImage2D(b,g,c,e,m,u,d,p,n)}function ga(){return Ma.pop()||new ea}function X(a){a.needsFree&&z.freeType(a.data);ea.call(a);Ma.push(a)}function Q(){A.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function H(a,b,c){var h=a.images[0]=ga();a.mipmask=1;h.width=a.width=b;h.height=a.height=c;h.channels=a.channels=4}function M(a,b){var c=null;if(v(b))c=a.images[0]=ga(),I(c,a),u(c,b),a.mipmask=1;else if(U(a,b),Array.isArray(b.mipmap))for(var h=
b.mipmap,e=0;e<h.length;++e)c=a.images[e]=ga(),I(c,a),c.width>>=e,c.height>>=e,u(c,h[e]),a.mipmask|=1<<e;else c=a.images[0]=ga(),I(c,a),u(c,b),a.mipmask=1;I(a,a.images[0])}function Ea(a,b){for(var c=a.images,e=0;e<c.length&&c[e];++e){var g=c[e],k=b,n=e,r=g.element,d=g.data,p=g.internalformat,m=g.format,u=g.type,v=g.width,z=g.height;ua(g);r?h.texImage2D(k,n,m,m,u,r):g.compressed?h.compressedTexImage2D(k,n,p,v,z,0,d):g.needsCopy?(w(),h.copyTexImage2D(k,n,m,g.xOffset,g.yOffset,v,z,0)):h.texImage2D(k,
n,m,v,z,0,m,u,d)}}function la(){var a=Ia.pop()||new Q;A.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function xa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&X(b[c]),b[c]=null;Ia.push(a)}function R(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function ha(a,b){"min"in b&&(a.minFilter=da[b.min],0<=k.indexOf(a.minFilter)&&(a.genMipmaps=!0));"mag"in b&&(a.magFilter=na[b.mag]);var c=a.wrapS,h=a.wrapT;if("wrap"in
b){var e=b.wrap;"string"===typeof e?c=h=J[e]:Array.isArray(e)&&(c=J[e[0]],h=J[e[1]])}else"wrapS"in b&&(c=J[b.wrapS]),"wrapT"in b&&(h=J[b.wrapT]);a.wrapS=c;a.wrapT=h;"anisotropic"in b&&(a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":a.mipmapHint=ca[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function ia(a,b){h.texParameteri(b,10241,a.minFilter);h.texParameteri(b,
10240,a.magFilter);h.texParameteri(b,10242,a.wrapS);h.texParameteri(b,10243,a.wrapT);e.ext_texture_filter_anisotropic&&h.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(h.hint(33170,a.mipmapHint),h.generateMipmap(b))}function qa(a){A.call(this);this.mipmask=0;this.internalformat=6408;this.id=Aa++;this.refCount=1;this.target=a;this.texture=h.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new R;V.profile&&(this.stats={size:0})}function ja(a){h.activeTexture(33984);h.bindTexture(a.target,
a.texture)}function Z(){var a=ma[0];a?h.bindTexture(a.target,a.texture):h.bindTexture(3553,null)}function ra(a){var b=a.texture,c=a.unit,e=a.target;0<=c&&(h.activeTexture(33984+c),h.bindTexture(e,null),ma[c]=null);h.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete Y[a.id];L.textureCount--}var ca={"don't care":4352,"dont care":4352,nice:4354,fast:4353},J={repeat:10497,clamp:33071,mirror:33648},na={nearest:9728,linear:9729},da=b({mipmap:9987,"nearest mipmap nearest":9984,
"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},na),P={none:0,browser:37444},S={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},T={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},aa={};e.ext_srgb&&(T.srgb=35904,T.srgba=35906);e.oes_texture_float&&(S.float32=S["float"]=5126);e.oes_texture_half_float&&(S.float16=S["half float"]=36193);e.webgl_depth_texture&&(b(T,{depth:6402,"depth stencil":34041}),
b(S,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&b(aa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&b(aa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&b(aa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(aa["rgb etc1"]=
36196);var ka=Array.prototype.slice.call(h.getParameter(34467));Object.keys(aa).forEach(function(a){var b=aa[a];0<=ka.indexOf(b)&&(T[a]=b)});var ta=Object.keys(T);t.textureFormats=ta;var oa=[];Object.keys(T).forEach(function(a){oa[T[a]]=a});var Ga=[];Object.keys(S).forEach(function(a){Ga[S[a]]=a});var Ha=[];Object.keys(na).forEach(function(a){Ha[na[a]]=a});var Ba=[];Object.keys(da).forEach(function(a){Ba[da[a]]=a});var Ca=[];Object.keys(J).forEach(function(a){Ca[J[a]]=a});var Oa=ta.reduce(function(a,
b){var c=T[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ma=[],Ia=[],Aa=0,Y={},sa=t.maxTextureUnits,ma=Array(sa).map(function(){return null});b(qa.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<sa;++b){var c=ma[b];if(c){if(0<c.bindCount)continue;c.unit=-1}ma[b]=this;a=b;break}V.profile&&L.maxTextureUnits<a+1&&(L.maxTextureUnits=a+1);this.unit=a;h.activeTexture(33984+a);h.bindTexture(this.target,
this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});V.profile&&(L.getTotalTextureSize=function(){var a=0;Object.keys(Y).forEach(function(b){a+=Y[b].stats.size});return a});return{create2D:function(b,c){function e(b,c){var f=g.texInfo;R.call(f);var h=la();"number"===typeof b?"number"===typeof c?H(h,b|0,c|0):H(h,b|0,b|0):b?(ha(f,b),M(h,b)):H(h,1,1);f.genMipmaps&&(h.mipmask=(h.width<<1)-1);g.mipmask=h.mipmask;I(g,h);g.internalformat=h.internalformat;
e.width=h.width;e.height=h.height;ja(g);Ea(h,3553);ia(f,3553);Z();xa(h);V.profile&&(g.stats.size=a(g.internalformat,g.type,h.width,h.height,f.genMipmaps,!1));e.format=oa[g.internalformat];e.type=Ga[g.type];e.mag=Ha[f.magFilter];e.min=Ba[f.minFilter];e.wrapS=Ca[f.wrapS];e.wrapT=Ca[f.wrapT];return e}var g=new qa(3553);Y[g.id]=g;L.textureCount++;e(b,c);e.subimage=function(a,b,c,f){b|=0;c|=0;f|=0;var d=ga();I(d,g);d.width=0;d.height=0;u(d,a);d.width=d.width||(g.width>>f)-b;d.height=d.height||(g.height>>
f)-c;ja(g);fa(d,3553,b,c,f);Z();X(d);return e};e.resize=function(b,c){var f=b|0,k=c|0||f;if(f===g.width&&k===g.height)return e;e.width=g.width=f;e.height=g.height=k;ja(g);for(var d=0;g.mipmask>>d;++d)h.texImage2D(3553,d,g.format,f>>d,k>>d,0,g.format,g.type,null);Z();V.profile&&(g.stats.size=a(g.internalformat,g.type,f,k,!1,!1));return e};e._reglType="texture2d";e._texture=g;V.profile&&(e.stats=g.stats);e.destroy=function(){g.decRef()};return e},createCube:function(b,c,e,g,k,n){function r(b,c,f,e,
h,g){var k,l=m.texInfo;R.call(l);for(k=0;6>k;++k)d[k]=la();if("number"===typeof b||!b)for(b=b|0||1,k=0;6>k;++k)H(d[k],b,b);else if("object"===typeof b)if(c)M(d[0],b),M(d[1],c),M(d[2],f),M(d[3],e),M(d[4],h),M(d[5],g);else if(ha(l,b),U(m,b),"faces"in b)for(b=b.faces,k=0;6>k;++k)I(d[k],m),M(d[k],b[k]);else for(k=0;6>k;++k)M(d[k],b);I(m,d[0]);m.mipmask=l.genMipmaps?(d[0].width<<1)-1:d[0].mipmask;m.internalformat=d[0].internalformat;r.width=d[0].width;r.height=d[0].height;ja(m);for(k=0;6>k;++k)Ea(d[k],
34069+k);ia(l,34067);Z();V.profile&&(m.stats.size=a(m.internalformat,m.type,r.width,r.height,l.genMipmaps,!0));r.format=oa[m.internalformat];r.type=Ga[m.type];r.mag=Ha[l.magFilter];r.min=Ba[l.minFilter];r.wrapS=Ca[l.wrapS];r.wrapT=Ca[l.wrapT];for(k=0;6>k;++k)xa(d[k]);return r}var m=new qa(34067);Y[m.id]=m;L.cubeCount++;var d=Array(6);r(b,c,e,g,k,n);r.subimage=function(a,b,c,d,f){c|=0;d|=0;f|=0;var e=ga();I(e,m);e.width=0;e.height=0;u(e,b);e.width=e.width||(m.width>>f)-c;e.height=e.height||(m.height>>
f)-d;ja(m);fa(e,34069+a,c,d,f);Z();X(e);return r};r.resize=function(b){b|=0;if(b!==m.width){r.width=m.width=b;r.height=m.height=b;ja(m);for(var c=0;6>c;++c)for(var d=0;m.mipmask>>d;++d)h.texImage2D(34069+c,d,m.format,b>>d,b>>d,0,m.format,m.type,null);Z();V.profile&&(m.stats.size=a(m.internalformat,m.type,r.width,r.height,!1,!0));return r}};r._reglType="textureCube";r._texture=m;V.profile&&(r.stats=m.stats);r.destroy=function(){m.decRef()};return r},clear:function(){for(var a=0;a<sa;++a)h.activeTexture(33984+
a),h.bindTexture(3553,null),ma[a]=null;F(Y).forEach(ra);L.cubeCount=0;L.textureCount=0},getTexture:function(a){return null},restore:function(){F(Y).forEach(function(a){a.texture=h.createTexture();h.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)h.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var c=0;6>c;++c)h.texImage2D(34069+c,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);
ia(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":3,"./util/extend":22,"./util/flatten":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],19:[function(e,t,w){t.exports=function(e,g){function t(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function v(a,b,c){var e=F.pop()||new t;e.startQueryIndex=a;e.endQueryIndex=b;e.sum=0;e.stats=c;w.push(e)}var c=g.ext_disjoint_timer_query;
if(!c)return null;var a=[],b=[],F=[],w=[],n=[],z=[];return{beginQuery:function(e){var g=a.pop()||c.createQueryEXT();c.beginQueryEXT(35007,g);b.push(g);v(b.length-1,b.length,e)},endQuery:function(){c.endQueryEXT(35007)},pushScopeStats:v,update:function(){var e,g;e=b.length;if(0!==e){z.length=Math.max(z.length,e+1);n.length=Math.max(n.length,e+1);n[0]=0;var p=z[0]=0;for(g=e=0;g<b.length;++g){var v=b[g];c.getQueryObjectEXT(v,34919)?(p+=c.getQueryObjectEXT(v,34918),a.push(v)):b[e++]=v;n[g+1]=p;z[g+1]=
e}b.length=e;for(g=e=0;g<w.length;++g){var p=w[g],k=p.startQueryIndex,v=p.endQueryIndex;p.sum+=n[v]-n[k];k=z[k];v=z[v];v===k?(p.stats.gpuTime+=p.sum/1E6,F.push(p)):(p.startQueryIndex=k,p.endQueryIndex=v,w[e++]=p)}w.length=e}},getNumPendingQueries:function(){return b.length},clear:function(){a.push.apply(a,b);for(var e=0;e<a.length;e++)c.deleteQueryEXT(a[e]);b.length=0;a.length=0},restore:function(){b.length=0;a.length=0}}}},{}],20:[function(e,t,w){t.exports="undefined"!==typeof performance&&performance.now?
function(){return performance.now()}:function(){return+new Date}},{}],21:[function(e,t,w){function p(e){return Array.prototype.slice.call(e)}function g(e){return p(e).join("")}var y=e("./extend");t.exports=function(){function e(){var b=[],c=[];return y(function(){b.push.apply(b,p(arguments))},{def:function(){var e="v"+a++;c.push(e);0<arguments.length&&(b.push(e,"="),b.push.apply(b,p(arguments)),b.push(";"));return e},toString:function(){return g([0<c.length?"var "+c+";":"",g(b)])}})}function c(){function a(e,
g){c(e,g,"=",b.def(e,g),";")}var b=e(),c=e(),g=b.toString,n=c.toString;return y(function(){b.apply(b,p(arguments))},{def:b.def,entry:b,exit:c,save:a,set:function(c,e,g){a(c,e);b(c,e,"=",g,";")},toString:function(){return g()+n()}})}var a=0,b=[],t=[],w=e(),n={};return{global:w,link:function(c){for(var e=0;e<t.length;++e)if(t[e]===c)return b[e];e="g"+a++;b.push(e);t.push(c);return e},block:e,proc:function(a,b){function e(){var a="a"+p.length;p.push(a);return a}var p=[];b=b||0;for(var v=0;v<b;++v)e();
var v=c(),k=v.toString;return n[a]=y(v,{arg:e,toString:function(){return g(["function(",p.join(),"){",k(),"}"])}})},scope:c,cond:function(){var a=g(arguments),b=c(),e=c(),n=b.toString,v=e.toString;return y(b,{then:function(){b.apply(b,p(arguments));return this},"else":function(){e.apply(e,p(arguments));return this},toString:function(){var b=v();b&&(b="else{"+b+"}");return g(["if(",a,"){",n(),"}",b])}})},compile:function(){var a=['"use strict";',w,"return {"];Object.keys(n).forEach(function(b){a.push('"',
b,'":',n[b].toString(),",")});a.push("}");var c=g(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,b.concat(c)).apply(null,t)}}}},{"./extend":22}],22:[function(e,t,w){t.exports=function(e,g){for(var t=Object.keys(g),v=0;v<t.length;++v)e[t[v]]=g[t[v]];return e}},{}],23:[function(e,t,w){function p(e,c,a,b,g,p){for(var n=0;n<c;++n)for(var t=e[n],r=0;r<a;++r)for(var y=t[r],w=0;w<b;++w)g[p++]=y[w]}function g(e,c,a,b,t){for(var y=1,n=a+1;n<c.length;++n)y*=c[n];var z=
c[a];if(4===c.length-a){var r=c[a+1],w=c[a+2];c=c[a+3];for(n=0;n<z;++n)p(e[n],r,w,c,b,t),t+=y}else for(n=0;n<z;++n)g(e[n],c,a+1,b,t),t+=y}var y=e("./pool");t.exports={shape:function(e){for(var c=[];e.length;e=e[0])c.push(e.length);return c},flatten:function(e,c,a,b){var t=1;if(c.length)for(var w=0;w<c.length;++w)t*=c[w];else t=0;a=b||y.allocType(a,t);switch(c.length){case 0:break;case 1:b=c[0];for(c=0;c<b;++c)a[c]=e[c];break;case 2:b=c[0];c=c[1];for(w=t=0;w<b;++w)for(var n=e[w],z=0;z<c;++z)a[t++]=
n[z];break;case 3:p(e,c[0],c[1],c[2],a,0);break;default:g(e,c,0,a,0)}return a}}},{"./pool":28}],24:[function(e,t,w){var p=e("./is-typed-array");t.exports=function(e){return Array.isArray(e)||p(e)}},{"./is-typed-array":26}],25:[function(e,t,w){var p=e("./is-typed-array");t.exports=function(e){return!!e&&"object"===typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"===typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||p(e.data))}},{"./is-typed-array":26}],26:[function(e,
t,w){var p=e("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in p}},{"../constants/arraytypes.json":3}],27:[function(e,t,w){t.exports=function(e,g){for(var t=Array(e),v=0;v<e;++v)t[v]=g(v);return t}},{}],28:[function(e,t,w){function p(c){var a,b;a=(65535<c)<<4;c>>>=a;b=(255<c)<<3;c>>>=b;a|=b;b=(15<c)<<2;c>>>=b;a|=b;b=(3<c)<<1;return a|b|c>>>b>>1}function g(c){a:{for(var a=16;268435456>=a;a*=16)if(c<=a){c=a;break a}c=0}a=v[p(c)>>2];return 0<a.length?a.pop():
new ArrayBuffer(c)}function y(c){v[p(c.byteLength)>>2].push(c)}var v=e("./loop")(8,function(){return[]});t.exports={alloc:g,free:y,allocType:function(c,a){var b=null;switch(c){case 5120:b=new Int8Array(g(a),0,a);break;case 5121:b=new Uint8Array(g(a),0,a);break;case 5122:b=new Int16Array(g(2*a),0,a);break;case 5123:b=new Uint16Array(g(2*a),0,a);break;case 5124:b=new Int32Array(g(4*a),0,a);break;case 5125:b=new Uint32Array(g(4*a),0,a);break;case 5126:b=new Float32Array(g(4*a),0,a);break;default:return null}return b.length!==
a?b.subarray(0,a):b},freeType:function(c){y(c.buffer)}}},{"./loop":27}],29:[function(e,t,w){t.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:{next:function(e){return setTimeout(e,16)},cancel:clearTimeout}},{}],30:[function(e,t,w){var p=e("./pool"),g=new Float32Array(1),y=new Uint32Array(g.buffer);t.exports=function(e){for(var c=p.allocType(5123,e.length),
a=0;a<e.length;++a)if(isNaN(e[a]))c[a]=65535;else if(Infinity===e[a])c[a]=31744;else if(-Infinity===e[a])c[a]=64512;else{g[0]=e[a];var b=y[0],t=b>>>31<<15,w=(b<<1>>>24)-127,b=b>>13&1023;c[a]=-24>w?t:-14>w?t+(b+1024>>-14-w):15<w?t+31744:t+(w+15<<10)+b}return c}},{"./pool":28}],31:[function(e,t,w){t.exports=function(e){return Object.keys(e).map(function(g){return e[g]})}},{}],32:[function(e,t,w){function p(a,b,e){function g(){var b=window.innerWidth,p=window.innerHeight;a!==document.body&&(p=a.getBoundingClientRect(),
b=p.right-p.left,p=p.bottom-p.top);n.width=e*b;n.height=e*p;c(n.style,{width:b+"px",height:p+"px"})}var n=document.createElement("canvas");c(n.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(n);a===document.body&&(n.style.position="absolute",c(a.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:n,onDestroy:function(){window.removeEventListener("resize",g);a.removeChild(n)}}}function g(a,b){function c(e){try{return a.getContext(e,b)}catch(g){return null}}
return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function y(a){return"string"===typeof a?a.split():a}function v(a){return"string"===typeof a?document.querySelector(a):a}var c=e("./util/extend");t.exports=function(a){var b=a||{},c,e,n,t;a={};var r=[],w=[],C="undefined"===typeof window?1:window.devicePixelRatio,N=!1,k=function(a){},m=function(){};"string"===typeof b?c=document.querySelector(b):"object"===typeof b&&("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&
"function"===typeof b.getBoundingClientRect?c=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(t=b,n=t.canvas):("gl"in b?t=b.gl:"canvas"in b?n=v(b.canvas):"container"in b&&(e=v(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(r=y(b.extensions)),"optionalExtensions"in b&&(w=y(b.optionalExtensions)),"onDone"in b&&(k=b.onDone),"profile"in b&&(N=!!b.profile),"pixelRatio"in b&&(C=+b.pixelRatio)));c&&("canvas"===c.nodeName.toLowerCase()?n=c:e=c);if(!t){if(!n){c=
p(e||document.body,k,C);if(!c)return null;n=c.canvas;m=c.onDestroy}t=g(n,a)}return t?{gl:t,canvas:n,container:e,extensions:r,optionalExtensions:w,pixelRatio:C,profile:N,onDone:k,onDestroy:m}:(m(),k("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/extend":22}],33:[function(e,t,w){function p(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var g=e("./lib/util/extend"),y=e("./lib/dynamic"),v=e("./lib/util/raf"),c=e("./lib/util/clock"),
a=e("./lib/strings"),b=e("./lib/webgl"),F=e("./lib/extension"),K=e("./lib/limits"),n=e("./lib/buffer"),z=e("./lib/elements"),r=e("./lib/texture"),D=e("./lib/renderbuffer"),C=e("./lib/framebuffer"),N=e("./lib/attribute"),k=e("./lib/shader"),m=e("./lib/read"),B=e("./lib/core"),U=e("./lib/stats"),L=e("./lib/timer");t.exports=function(e){function h(){if(0===P.length)M&&M.update(),ka=null;else{ka=v.next(h);za();for(var a=P.length-1;0<=a;--a){var b=P[a];b&&b(R,null,0)}u.flush();M&&M.update()}}function t(){!ka&&
0<P.length&&(ka=v.next(h))}function w(){ka&&(v.cancel(h),ka=null)}function Ja(a){a.preventDefault();w();S.forEach(function(a){a()})}function ya(a){u.getError();ga.restore();ja.restore();ia.restore();Z.restore();ra.restore();ca.restore();M&&M.restore();J.procs.refresh();t();T.forEach(function(a){a()})}function Da(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var g=a[b];y.isDynamic(g)?e[b]=y.unbox(g,b):c[b]=g});return{dynamic:e,"static":c}}function c(a){for(;t.length<a;)t.push(null);
return t}var e=b(a.context||{}),h=b(a.uniforms||{}),k=b(a.attributes||{}),m=b(function(a){function b(a){if(a in c){var f=c[a];delete c[a];Object.keys(f).forEach(function(b){c[a+"."+b]=f[b]})}}var c=g({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=
J.compile(m,k,h,e,a),n=e.draw,p=e.batch,r=e.scope,t=[];return g(function(a,b){var e;if("function"===typeof a)return r.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<a;++e)r.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)r.call(this,a[e],b,e);else return r.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)},{stats:a})}function V(a,
b){var c=0;J.procs.poll();var e=b.color;e&&(u.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),c|=16384);"depth"in b&&(u.clearDepth(+b.depth),c|=256);"stencil"in b&&(u.clearStencil(b.stencil|0),c|=1024);u.clear(c)}function A(a){P.push(a);t();return{cancel:function(){function b(){var a=p(P,b);P[a]=P[P.length-1];--P.length;0>=P.length&&w()}var c=p(P,a);P[c]=b}}}function I(){var a=na.viewport,b=na.scissor_box;a[0]=a[1]=b[0]=b[1]=0;R.viewportWidth=R.framebufferWidth=R.drawingBufferWidth=a[2]=b[2]=u.drawingBufferWidth;
R.viewportHeight=R.framebufferHeight=R.drawingBufferHeight=a[3]=b[3]=u.drawingBufferHeight}function za(){R.tick+=1;R.time=ea();I();J.procs.poll()}function ua(){I();J.procs.refresh();M&&M.update()}function ea(){return(c()-Ea)/1E3}e=b(e);if(!e)return null;var u=e.gl,fa=u.getContextAttributes();u.isContextLost();var ga=F(u,e);if(!ga)return null;var X=a(),Q=U(),H=ga.extensions,M=L(u,H),Ea=c(),la=u.drawingBufferWidth,xa=u.drawingBufferHeight,R={tick:0,time:0,viewportWidth:la,viewportHeight:xa,framebufferWidth:la,
framebufferHeight:xa,drawingBufferWidth:la,drawingBufferHeight:xa,pixelRatio:e.pixelRatio},ha=K(u,H),ia=n(u,Q,e),qa=z(u,H,ia,Q),la=N(u,H,ha,ia,X),ja=k(u,X,Q,e),Z=r(u,H,ha,function(){J.procs.poll()},R,Q,e),ra=D(u,H,ha,Q,e),ca=C(u,H,ha,Z,ra,Q),J=B(u,X,H,ha,ia,qa,Z,ca,{},la,ja,{elements:null,primitive:4,count:-1,offset:0,instances:-1},R,M,e),X=m(u,ca,J.procs.poll,R,fa,H),na=J.next,da=u.canvas,P=[],S=[],T=[],aa=[e.onDestroy],ka=null;da&&(da.addEventListener("webglcontextlost",Ja,!1),da.addEventListener("webglcontextrestored",
ya,!1));var ta=ca.setFBO=Da({framebuffer:y.define.call(null,1,"framebuffer")});ua();fa=g(Da,{clear:function(a){if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ta(g({framebuffer:a.framebuffer.faces[b]},a),V);else ta(a,V);else V(null,a)},prop:y.define.bind(null,1),context:y.define.bind(null,2),"this":y.define.bind(null,3),draw:Da({}),buffer:function(a){return ia.create(a,34962,!1,!1)},elements:function(a){return qa.create(a,!1)},texture:Z.create2D,
cube:Z.createCube,renderbuffer:ra.create,framebuffer:ca.create,framebufferCube:ca.createCube,attributes:fa,frame:A,on:function(a,b){var c;switch(a){case "frame":return A(b);case "lost":c=S;break;case "restore":c=T;break;case "destroy":c=aa}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ha,hasExtension:function(a){return 0<=ha.extensions.indexOf(a.toLowerCase())},read:X,destroy:function(){P.length=0;w();da&&(da.removeEventListener("webglcontextlost",
Ja),da.removeEventListener("webglcontextrestored",ya));ja.clear();ca.clear();ra.clear();Z.clear();qa.clear();ia.clear();M&&M.clear();aa.forEach(function(a){a()})},_gl:u,_refresh:ua,poll:function(){za();M&&M.update()},now:ea,stats:Q});e.onDone(null,fa);return fa}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/stats":16,"./lib/strings":17,
"./lib/texture":18,"./lib/timer":19,"./lib/util/clock":20,"./lib/util/extend":22,"./lib/util/raf":29,"./lib/webgl":32}]},{},[33])(33)});
